{{- if .Values.externalSecrets.enabled }}
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ include "lakehouse-ingestion.fullname" . }}-minio-secrets
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "lakehouse-ingestion.labels" . | nindent 4 }}
spec:
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStore.name }}
    kind: {{ .Values.externalSecrets.secretStore.kind }}
  target:
    name: {{ include "lakehouse-ingestion.fullname" . }}-minio-secrets
    creationPolicy: Owner
    template:
      data:
        # Access key is the username (spark-user-key)
        AWS_ACCESS_KEY_ID: {{ .Values.externalSecrets.minio.accessKey | quote }}
        # Secret key pulled from Vault
        AWS_SECRET_ACCESS_KEY: {{ `"{{ .secretKey }}"` }}
  data:
    - secretKey: secretKey
      remoteRef:
        key: {{ .Values.externalSecrets.minio.vaultPath }}
        property: {{ .Values.externalSecrets.minio.secretProperty }}
{{- end }}
